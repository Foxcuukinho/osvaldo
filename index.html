<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OsvaldoFlix</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #111; color: #fff; font-family: sans-serif; }

    h1 { text-align: center; padding: 20px; font-size: 1.6rem; color: #eee; }

    .search-bar {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 10px 20px;
      flex-wrap: wrap;
    }

    .search-bar input {
      background: #222;
      color: #fff;
      border: 1px solid #444;
      padding: 10px 14px;
      border-radius: 6px;
      font-size: 1rem;
      width: 300px;
    }

    .search-bar button {
      background: #e50914;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
    }

    .search-bar button:hover { background: #b0060f; }

    .results {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      padding: 10px 20px;
      max-height: 320px;
      overflow-y: auto;
    }

    .card {
      width: 110px;
      cursor: pointer;
      border-radius: 6px;
      overflow: hidden;
      border: 2px solid transparent;
      transition: border 0.2s;
    }

    .card:hover, .card.active { border-color: #e50914; }

    .card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      display: block;
    }

    .card p {
      font-size: 0.7rem;
      text-align: center;
      padding: 4px;
      background: #222;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      padding: 10px;
    }

    select {
      background: #222;
      color: #fff;
      border: 1px solid #444;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
    }

    .play-btn {
      background: #e50914;
      color: #fff;
      border: none;
      padding: 8px 20px;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
    }

    .play-btn:hover { background: #b0060f; }

    .player-wrap {
      width: 100%;
      max-width: 960px;
      margin: 20px auto;
      aspect-ratio: 16/9;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 8px;
    }

    #season-wrap { display: none; gap: 10px; }

    .loading {
      text-align: center;
      color: #aaa;
      padding: 10px;
      display: none;
    }
  </style>
</head>
<body>

  <h1>üé¨ Player</h1>

  <div class="search-bar">
    <input type="text" id="query" placeholder="Buscar filme ou s√©rie..." onkeydown="if(event.key==='Enter')buscar()">
    <button onclick="buscar()">üîç Buscar</button>
  </div>

  <div class="loading" id="loading">Buscando...</div>
  <div class="results" id="results"></div>

  <div class="controls">
    <select id="server">
      <option value="vidsrcme">Vidsrc.me</option>
      <option value="vidsrcto">Vidsrc.to</option>
      <option value="vidlink">Vidlink</option>
    </select>

    <div id="season-wrap">
      <select id="season"></select>
      <select id="episode"></select>
    </div>

    <button class="play-btn" onclick="play()">‚ñ∂ Assistir</button>
  </div>

  <div class="player-wrap">
    <iframe id="player"
      src="about:blank"
      allowfullscreen
      allow="autoplay; fullscreen">
    </iframe>
  </div>

  <script>
    const API_KEY = '7ac6de5ca5060c7504e05da7b218a30c';
    let selected = null;

    async function buscar() {
      const q = document.getElementById('query').value.trim();
      if (!q) return;
      document.getElementById('loading').style.display = 'block';
      document.getElementById('results').innerHTML = '';

      const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API_KEY}&query=${encodeURIComponent(q)}&language=pt-BR`);
      const data = await res.json();
      document.getElementById('loading').style.display = 'none';

      const results = data.results.filter(r => r.media_type === 'tv' || r.media_type === 'movie').slice(0, 12);
      const container = document.getElementById('results');

      results.forEach(item => {
        const div = document.createElement('div');
        div.className = 'card';
        const tipo = item.media_type === 'movie' ? 'üé¨' : 'üì∫';
        div.innerHTML = `
          <img src="${item.poster_path ? 'https://image.tmdb.org/t/p/w200' + item.poster_path : 'https://placehold.co/110x160/222/aaa?text=Sem+Capa'}" alt="">
          <p>${tipo} ${item.title || item.name}</p>
        `;
        div.onclick = () => selecionar(item, div);
        container.appendChild(div);
      });
    }

    async function selecionar(item, el) {
      document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
      el.classList.add('active');
      selected = item;

      if (item.media_type === 'tv') {
        document.getElementById('season-wrap').style.display = 'flex';
        await carregarTemporadas(item.id);
      } else {
        document.getElementById('season-wrap').style.display = 'none';
      }
    }

    async function carregarTemporadas(id) {
      const res = await fetch(`https://api.themoviedb.org/3/tv/${id}?api_key=${API_KEY}&language=pt-BR`);
      const data = await res.json();
      const sel = document.getElementById('season');
      sel.innerHTML = '';
      data.seasons.filter(s => s.season_number > 0).forEach(s => {
        const opt = document.createElement('option');
        opt.value = s.season_number;
        opt.textContent = `Temporada ${s.season_number}`;
        sel.appendChild(opt);
      });
      sel.onchange = () => carregarEpisodios(id, sel.value);
      carregarEpisodios(id, sel.value);
    }

    async function carregarEpisodios(id, season) {
      const res = await fetch(`https://api.themoviedb.org/3/tv/${id}/season/${season}?api_key=${API_KEY}`);
      const data = await res.json();
      const sel = document.getElementById('episode');
      sel.innerHTML = '';
      data.episodes.forEach(ep => {
        const opt = document.createElement('option');
        opt.value = ep.episode_number;
        opt.textContent = `Ep ${ep.episode_number} - ${ep.name}`;
        sel.appendChild(opt);
      });
    }

    function getUrl(server, id, type, s, e) {
      if (type === 'movie') {
        if (server === 'vidsrcme') return `https://vidsrcme.ru/embed/movie?tmdb=${id}`;
        if (server === 'vidsrcto') return `https://vidsrc.to/embed/movie/${id}`;
        if (server === 'vidlink')  return `https://vidlink.pro/movie/${id}`;
      } else {
        if (server === 'vidsrcme') return `https://vidsrcme.ru/embed/tv?tmdb=${id}&season=${s}&episode=${e}`;
        if (server === 'vidsrcto') return `https://vidsrc.to/embed/tv/${id}/${s}/${e}`;
        if (server === 'vidlink')  return `https://vidlink.pro/tv/${id}/${s}/${e}`;
      }
    }

    function play() {
      if (!selected) { alert('Selecione um t√≠tulo primeiro!'); return; }
      const sv = document.getElementById('server').value;
      const s = document.getElementById('season')?.value;
      const e = document.getElementById('episode')?.value;
      const url = getUrl(sv, selected.id, selected.media_type, s, e);
      document.getElementById('player').src = url;
    }


  </script>

</body>
</html>